---
layout: post
title: 云崽安装教程
date: 2022-10-18 11:58:46 +0800
categories: 应用 云崽
tags: 教程 Linux 云崽
excerpt: 原神 QQ 群机器人云崽安装教程，及遇错解决方案。
---

## 目录<!-- omit from toc -->

- [1. 准备运行云崽](#1-准备运行云崽)
  - [1.1. 更新源索引及应用](#11-更新源索引及应用)
  - [1.2. 安装常用应用](#12-安装常用应用)
    - [1.2.1. 安装包管理器](#121-安装包管理器)
    - [1.2.2. 安装下载应用](#122-安装下载应用)
    - [1.2.3. 安装编译库](#123-安装编译库)
    - [1.2.4. 安装编辑应用](#124-安装编辑应用)
  - [1.3. 安装字体](#13-安装字体)
  - [1.4. 安装 Git](#14-安装-git)
    - [1.4.1. 准备安装 Git](#141-准备安装-git)
    - [1.4.2. 获取、编译并安装 Git](#142-获取编译并安装-git)
  - [1.5. 安装 Redis](#15-安装-redis)
    - [1.5.1. 获取、编译并安装 Redis](#151-获取编译并安装-redis)
  - [1.6. 安装 Chromium](#16-安装-chromium)
    - [1.6.1. 准备安装 Chromium](#161-准备安装-chromium)
    - [1.6.2. 获取、编译并安装 Chromium](#162-获取编译并安装-chromium)
  - [1.7. 安装 FFmpeg（可选）](#17-安装-ffmpeg可选)
    - [1.7.1. 准备安装 FFmpeg](#171-准备安装-ffmpeg)
      - [1.7.1.1. 安装 opencore-amr](#1711-安装-opencore-amr)
    - [1.7.2. 获取、编译并安装 FFmpeg](#172-获取编译并安装-ffmpeg)
  - [1.8. 安装 PNPM](#18-安装-pnpm)
  - [1.9. 下载云崽](#19-下载云崽)
    - [1.9.1. 下载云崽源码](#191-下载云崽源码)
    - [1.9.2. 安装云崽依赖](#192-安装云崽依赖)
  - [1.10. 下载云崽插件（可选）](#110-下载云崽插件可选)
    - [1.10.1. 下载喵喵插件](#1101-下载喵喵插件)
      - [1.10.1.1. 下载喵喵插件源码](#11011-下载喵喵插件源码)
      - [1.10.1.2. 安装喵喵插件依赖](#11012-安装喵喵插件依赖)
    - [1.10.2. 下载 PY 插件](#1102-下载-py-插件)
      - [1.10.2.1. 安装 Python](#11021-安装-python)
        - [1.10.2.1.1. 准备安装 Python](#110211-准备安装-python)
        - [1.10.2.1.2. 获取、编译并安装 Python](#110212-获取编译并安装-python)
      - [1.10.2.2. 安装 Poetry](#11022-安装-poetry)
      - [1.10.2.3. 下载 PY 插件源码](#11023-下载-py-插件源码)
      - [1.10.2.4. 安装 PY 插件依赖](#11024-安装-py-插件依赖)
    - [1.10.3. 下载图鉴插件](#1103-下载图鉴插件)
      - [1.10.3.1. 下载图鉴插件源码](#11031-下载图鉴插件源码)
      - [1.10.3.2. 安装图鉴插件依赖](#11032-安装图鉴插件依赖)
    - [1.10.4. 下载闲心插件](#1104-下载闲心插件)
    - [1.10.5. 下载锅巴插件](#1105-下载锅巴插件)
      - [1.10.5.1. 下载锅巴插件源码](#11051-下载锅巴插件源码)
      - [1.10.5.2. 安装锅巴插件依赖](#11052-安装锅巴插件依赖)
    - [1.10.6. 下载成就插件](#1106-下载成就插件)
    - [1.10.7. 下载 TRSS 插件](#1107-下载-trss-插件)
      - [1.10.7.1. 准备 TRSS 插件环境](#11071-准备-trss-插件环境)
      - [1.10.7.2. 下载 TRSS 插件源码](#11072-下载-trss-插件源码)
      - [1.10.7.3. 安装 TRSS 插件依赖](#11073-安装-trss-插件依赖)
      - [1.10.7.4. 安装原神语音合成功能](#11074-安装原神语音合成功能)
- [2. 运行云崽](#2-运行云崽)
  - [2.1. 运行 Redis](#21-运行-redis)
  - [2.2. 首次运行云崽](#22-首次运行云崽)
  - [2.3. 后台启动](#23-后台启动)
  - [2.4. 后台重启](#24-后台重启)
  - [2.5. 后台查看运行日志](#25-后台查看运行日志)
- [3. 友好链接](#3-友好链接)

## 1. 准备运行云崽

### 1.1. 更新源索引及应用

> **提示**
>
> Linux 上的软件包管理命令基本都可以根据当前系统使用的包管理器（如：`apt`、`yum` 等）来选择对应命令进行使用。

- Debian/Ubuntu

  ```sh
  sudo apt update && \
  sudo apt upgrade -y
  ```

- Fedora/RHEL/CentOS

  > **注意**
  >
  > 某些系统可能已改用 `dnf` 作包管理器。这些系统请将以下所有的 `yum` 改成 `dnf`。

  ```sh
  sudo yum update
  ```

- Arch

  ```sh
  sudo pacman -Syu
  ```

- Alpine

  ```sh
  sudo apk update && \
  sudo apk upgrade
  ```

### 1.2. 安装常用应用

#### 1.2.1. 安装包管理器

- Fedora/RHEL/CentOS

  安装 [Dandified YUM](https://github.com/rpm-software-management/dnf "rpm-software-management/dnf: Package manager based on libdnf and libsolv. Replaces YUM.")

  > **注意**
  >
  > 当系统已使用 Dandified YUM 作包管理器时，可跳过此步。

  ```sh
  sudo yum install dnf -y
  ```

- Arch

  安装 [Yet Another Yogurt](https://github.com/Jguer/yay "Jguer/yay: Yet another Yogurt - An AUR Helper written in Go")

  1. 安装必要软件库

     ```sh
     sudo pacman -S --needed git base-devel
     ```

     > **提示**
     >
     > 使用 `--needed` 参数后将不会重新安装已有且最新的目标软件。

  2. 获取、编译并安装 Yet Another Yogurt

     1. 进入用户目录并下载源码

        ```sh
        cd ~ && \
        git clone https://aur.archlinux.org/yay.git
        ```

     1. 编译源码并安装

        ```sh
        cd yay  && \
        makepkg -si
        ```

  > **提示**
  >
  > 安装完成后可将源码删除。
  >
  > ```sh
  > cd ~ && \
  > rm -rf yay
  > ```

#### 1.2.2. 安装下载应用

- Debian/Ubuntu

  ```sh
  sudo apt install wget curl -y
  ```

- Fedora/RHEL/CentOS

  ```sh
  sudo yum install wget curl -y
  ```

- Arch

  ```sh
  sudo pacman -S wget curl
  ```

- Alpine

  ```sh
  sudo apk add wget curl
  ```

> **解释**
>
> - `wget` 即 GNU Wget，用于下载在网络上的资源。
>
> - `curl` 即 Client URL，用于向 Web 服务器发出请求并在命令行输出结果。

#### 1.2.3. 安装编译库

> **注意**
>
> - 若要使用语音功能，则需要[安装 FFmpeg](#17-安装-ffmpeg可选 "安装 FFmpeg")，Debian/Ubuntu/Fedora/RHEL/CentOS~~/Alpine~~ 就需要安装编译库。
>
> - Arch 无需自行编译源码，可跳过此步。
>
> - Alpine 暂时不知如何编译 FFmpeg，可以跳过此步。如若有谁知道，劳烦在下面提出。

- Debian/Ubuntu

  ```sh
  sudo apt install gcc g++ make cmake yasm pkg-config build-essential checkinstall -y
  ```

- Fedora/RHEL/CentOS

  ```sh
  sudo yum install gcc g++ make cmake yasm pkg-config -y
  ```

- ~~Alpine~~

  ```sh
  # sudo apk add gcc g++ make cmake yasm
  ```

> **注意**
>
> ~~Alpine 需先创建源码文件夹。~~
>
> ```sh
> # sudo mkdir -p /usr/local/src
> ```
>
> **提示**
>
> 在安装完成后，以上库皆可删除。但之后重新安装时记得下回来哦。
>
> - Debian/Ubuntu
>
>   ```sh
>   sudo apt remove --purge -y \
>      gcc g++ make cmake yasm pkg-config build-essential checkinstall
>   ```
>
> - Fedora/RHEL/CentOS
>
>   ```sh
>   sudo yum remove --purge gcc g++ make cmake yasm pkg-config build-essential checkinstall -y
>   ```
>
> - ~~Alpine~~
>
>   ```sh
>   # sudo apk del gcc g++ make cmake yasm
>   ```

#### 1.2.4. 安装编辑应用

- Debian/Ubuntu

  ```sh
  sudo apt install vim -y
  ```

- Fedora/RHEL/CentOS

  ```sh
  sudo yum install vim -y
  ```

- Arch

  ```sh
  sudo pacman -S vim
  ```

- Alpine

  ```sh
  sudo apk add vim
  ```

### 1.3. 安装字体

> **注意**
>
> 此处以自定义安装原神字体为例。若不想安装原神字体，可直接安装字体包。
>
> - Debian/Ubuntu
>
>   ```sh
>   sudo apt install --force-yes --no-install-recommends fonts-wqy-microhei -y
>   ```
>
> - Fedora/RHEL/CentOS
>
>   ```sh
>   sudo yum groupinstall fonts -y
>   ```
>
> - Arch
>
>   ```sh
>   sudo pacman -S noto-fonts-cjk
>   ```
>
> - Alpine
>
>   ```sh
>   sudo apk add wqy-zenhei
>   ```

1. 创建并进入字体存放文件夹

   - Debian/Ubuntu

     ```sh
     sudo mkdir -p /usr/share/fonts/truetype/mihoyo && \
     cd /usr/share/fonts/truetype/mihoyo
     ```

   - Defora/RHEL/CentOS

     ```sh
     sudo mkdir -p /usr/share/fonts/mihoyo && \
     cd /usr/share/fonts/mihoyo
     ```

   - Arch/Alpine

     ```sh
     sudo mkdir -p /usr/share/fonts/ttf/miHoYo && \
     cd /usr/share/fonts/ttf/miHoYo
     ```

2. 下载字体并更改其权限

   ```sh
   sudo wget https://file.letsshareall.com/others/fonts/汉仪文黑-85W_Heavy.ttf \
      -O HanyiWenhei85W-Heavy.ttf && \
   sudo chmod 644 HanyiWenhei85W-Heavy.ttf
   ```

   > **解释**
   >
   > `-O` 参数等价于 `--output-document=`，用于将下载的文档写入目标文件。易混淆的参数有等价于 `--output-file=` 的 `-o`，用于将下载日志信息写入目标文件。

> **提示**
>
> - 若安装中文字体后云崽发送的图片中会出现`？`或者`□`等符号，则可尝试重启云崽或系统解决，若问题依旧，则请尝试安装其他中文字体。
>
> - 详见 [Debian 官方文档](https://www.debian.org/doc/manuals/users-guide/ch-ctsystem.en.html "User's Guide (Obsolete Documentation) - Configuring the System")、[Arch 官方文档](https://wiki.archlinux.org/title/Fonts#Manual_installation "Fonts - ArchWiki")、[Alpine 官方文档](https://wiki.alpinelinux.org/wiki/Fonts "Fonts - Alpine Linux")。

### 1.4. 安装 [Git](https://git-scm.com "Git")

> **注意**
>
> 若不想编译安装，可直接使用包管理器安装（不为最新版）。
>
> - Debian/Ubuntu
>
>   ```sh
>   sudo apt install git -y
>   ```
>
> - Fedora/RHEL/CentOS
>
>   ```sh
>   sudo yum install git -y
>   ```
>
> - Arch
>
>   ```sh
>   sudo pacman -S git
>   ```
>
> - Alpine
>
>   ```sh
>   sudo apk add git
>   ```

#### 1.4.1. 准备安装 Git

- Debian/Ubuntu

  1. 安装 Git 依赖库

     ```sh
     sudo apt install dh-autoreconf libcurl4-gnutls-dev libexpat1-dev \
        gettext libz-dev libssl-dev -y
     ```

  2. 安装附加依赖库

     ```sh
     sudo apt install asciidoc xmlto docbook2x -y
     ```

     > **解释**
     >
     > 这些依赖库可为 Git 提供添加各种格式文档（doc、html、info）的支持。

  3. 安装 `install-info`

     ```sh
     sudo apt install install-info -y
     ```

- Fedora/RHEL/CentOS

  1. 安装 Git 依赖库

     ```sh
     sudo dnf install dh-autoreconf curl-devel expat-devel gettext-devel \
        openssl-devel perl-devel zlib-devel -y
     ```

  2. 安装附加依赖库

     ```sh
     sudo dnf install asciidoc xmlto docbook2X -y
     ```

  3. 安装 `getopt` 包

     ```sh
     sudo dnf install getopt -y
     ```

  4. 创建 `docbook2x` 软链接

     ```sh
     sudo ln -s /usr/bin/db2x_docbook2texi /usr/bin/docbook2x-texi
     ```

     > **解释**
     >
     > 此处创建软链接是因为 Git 编译时使用的库名与 Dandified YUM 安装库时使用的库名不同。

#### 1.4.2. 获取、编译并安装 Git

1. 进入用户源码目录并下载源码

   ```sh
   cd /usr/local/src && \
   sudo wget https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.38.0.tar.xz
   ```

2. 解压、编译源码并安装

   ```sh
   sudo tar -xf git-2.38.0.tar.xz -C .
   ```

   > **解释**
   >
   > `-C` 参数等价于 `--directory=`，用于指定解压的目标目录。
   >
   > **注意**
   >
   > 当解压 `*.tar.xz` 文件时出现 `找不到 xz 命令` 错误时，可尝试安装 `xz-utils` 包解决。
   >
   > - Debian/Ubuntu
   >
   >   ```sh
   >   sudo apt install xz-utils -y
   >   ```
   >
   > - Fedora/RHEL/CentOS
   >
   >   ```sh
   >   sudo yum install xz -y
   >   ```

   ```sh
   cd git-2.38.0 && \
   sudo make configure
   ```

   ```sh
   sudo ./configure --prefix=/usr
   ```

   ```sh
   sudo make all doc info
   ```

   ```sh
   sudo make install install-doc install-html install-info
   ```

> **提示**
>
> - 一般经过源码编译安装的软件，都可在源码目录中 `Makefile` 文件所在目录使用 `sudo make uninstall` 命令卸载。
>
> - 经过源码编译安装的软件，可通过更新源码并再次编译安装以更新软件。
>
> - 当今后想要更新 Git 时，可使用 Git 获取源码并根据以上教程进行编译更新。
>
>   ```sh
>   sudo git clone git://git.kernel.org/pub/scm/git/git.git /usr/local/src/
>   ```
>
> - 可以使用 `git config` 命令让 Git 使用代理服务器.
>
>   ```sh
>   git config --global http.https://github.com.proxy http://127.0.0.1:7890
>   git config --global http.https://github.com.proxy socks5://127.0.0.1:7891
>   ```
>
> - 使用 `git config --unset` 取消代理。
>
>   ```sh
>    git config --global --unset http.proxy
>    git config --global --unset https.proxy
>   ```
>
> - 详见[官方文档](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git "Git - Installing Git")。

### 1.5. 安装 [Redis](https://redis.io/ "Redis")

> **注意**
>
> 若不想进行编译安装，可直接使用包管理器进行安装。
>
> - Debian/Ubuntu
>
>   ```sh
>   sudo apt install redis-server -y
>   ```
>
> - Fedora/RHEL/CentOS
>
>   ```sh
>   sudo yum install redis -y
>   ```
>
> - Arch
>
>   ```sh
>   sudo pacman -S redis
>   ```
>
> - Alpine
>
>   ```sh
>   sudo apk add redis
>   ```

#### 1.5.1. 获取、编译并安装 Redis

1. 进入用户源码目录并下载源码

   ```sh
   cd /usr/local/src && \
   sudo wget https://download.redis.io/redis-stable.tar.gz
   ```

2. 解压、编译源码并安装

   ```sh
   sudo tar -xf redis-stable.tar.gz -C .
   ```

   ```sh
   cd redis-stable && \
   sudo make
   ```

   ```sh
   sudo make install
   ```

> **提示**
>
> 详见[官方文档](https://redis.io/docs/getting-started/installation/install-redis-from-source/ "Install Redis from Source - Redis")。

### 1.6. 安装 [Chromium](https://www.chromium.org/chromium-projects/ "Home - The Chromium Projects")

> **注意**
>
> - Chromium 的编译安装至少需要 8GB 主存（运行内存），推荐 16GB 主存。
>
> - 若不想编译安装，可直接使用包管理器进行安装。
>
>   - Debian
>
>     ```sh
>     sudo apt install chromium -y
>     ```
>
>   - Ubuntu
>
>     ```sh
>     sudo apt install chromium-browser -y
>     ```
>
>   - Fedora/RHEL/CentOS
>
>     ```sh
>     sudo yum install chromium -y
>     ```
>
>   - Arch
>
>     ```sh
>     sudo pacman -S chromium
>     ```
>
>   - Alpine
>
>     ```sh
>     sudo apk add chromium
>     ```

#### 1.6.1. 准备安装 Chromium

1. 安装 `depot-tools`

   1. 进入用户文件夹并克隆 `depot-tools`

      ```sh
      cd ~ && \
      git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git
      ```

   2. 将 `depot-tools` 添加至 `$PATH` 并刷新环境变量的修改

      ```sh
      cat >> ~/.bashrc << EOF

      # depot_tools
      export PATH="\$PATH:\${HOME}/depot_tools"
      # depot_tools end
      EOF
      ```

      ```sh
      source ~/.bashrc
      ```

      > **解释**
      >
      > - `cat` 某些内容后跟 `>>` 某文件是在某文件内容后追加某些内容。
      >
      > - `EOF` 即 `End Of File`，用于在终端处理多行内容。它以 `<< EOF` 开始，以 `EOF` 结尾。

#### 1.6.2. 获取、编译并安装 Chromium

1. 进入用户源码目录并下载源码

   ```sh
   cd /usr/local/scr && \
   sudo mkdir chromium && \
   cd chromium && \
   sudo fecth --nohooks --no-history chromium
   ```

   > **解释**
   >
   > - `fetch` 来自于准备阶段下载的 `depot_tools`，可以获取源码及软件依赖。
   >
   > - 添加 `--no-history` 参数则 `fetch` 不会获取所有历史源码。此举可有效节省大量时间。

2. 进入源码目录并安装用于编译的附加依赖

   ```sh
   cd src && \
   sudo ./build/install-build-deps.sh
   ```

3. 运行钩子

   ```sh
   gclient runhooks
   ```

   > **解释**
   >
   > 在此处运行的钩子为 Chromium 特定的钩子，将会下载可能会用到的附加二进制文件等。
   >
   > **提示**
   >
   > 你可以选择在这时安装用于使用谷歌服务的 [API 密钥](https://www.chromium.org/developers/how-tos/api-keys/ "API keys")。此为非必须步骤。

4. 编译源码并安装

   ```sh
   gn gen out/Default
   ```

   > **解释**
   >
   > Chromium 使用将 [Ninja](https://www.chromium.org/developers/how-tos/api-keys/ "Ninja, a small build system with a focus on speed") 作为主要编译工具的 [GN](https://gn.googlesource.com/gn/+/main/docs/quick_start.md "GN Quick Start guide") 工具生成 `.ninja` 文件。

> **提示**
>
> 详见[官方文档](https://chromium.googlesource.com/chromium/src/+/main/docs/linux/build_instructions.md "Chromium Docs - Checking out and building Chromium on Linux")。

### 1.7. 安装 [FFmpeg](https://ffmpeg.org/ "FFmpeg")（可选）

> **注意**
>
> - 若要使用语言功能插件，则一定得安装 FFmpeg。
>
> - Debian/Ubuntu/Fedora/RHEL/CentOS/~~Alpine~~ 请先[安装编译工具](#123-安装编译库 "安装编译库")。
>
> - Arch 安装的 FFmpeg 支持 AMR 转码，无需自行编译。
>
> - 若不想手动编译安装，可用包管理器安装。
>
>   - Arch
>
>     ```sh
>     sudo pacman -S ffmpeg
>     ```
>
>   - ~~Alpine~~
>
>     ```sh
>     # sudo apk add ffmpeg
>     ```
>
> - Alpine 这样安装的 FFmpeg 并不能将音频转码成 AMR 格式。

#### 1.7.1. 准备安装 FFmpeg

1. 安装编译依赖库

   - Debian/Ubuntu

     ```sh
     sudo apt-get update -qq && sudo apt-get -y install \
        autoconf \
        automake \
        libass-dev \
        libfreetype6-dev \
        libgnutls28-dev \
        libmp3lame-dev \
        libsdl2-dev \
        libtool \
        libva-dev \
        libvdpau-dev \
        libvorbis-dev \
        libxcb1-dev \
        libxcb-shm0-dev \
        libxcb-xfixes0-dev \
        meson \
        ninja-build \
        texinfo \
        yasm \
        zlib1g-dev \
        libunistring-dev libaom-dev libdav1d-dev
     ```

   - Fedora/RHEL/CentOS

     ```sh
     yum install -y \
        autoconf automake bzip2 bzip2-devel cmake freetype-devel \
        gcc gcc-c++ git libtool make pkgconfig zlib-devel
     ```

   > **提示**
   >
   > 在编译安装完成后，这些库可以移除。
   >
   > 请务必在所有步骤完成后执行！
   >
   > - Debian/Ubuntu
   >
   >   ```sh
   >   sudo apt remove --purge -y \
   >     autoconf \
   >     automake \
   >     libass-dev \
   >     libfreetype6-dev \
   >     libgnutls28-dev \
   >     libmp3lame-dev \
   >     libsdl2-dev \
   >     libtool \
   >     libva-dev \
   >     libvdpau-dev \
   >     libvorbis-dev \
   >     libxcb1-dev \
   >     libxcb-shm0-dev \
   >     libxcb-xfixes0-dev \
   >     meson \
   >     ninja-build \
   >     texinfo \
   >     yasm \
   >     zlib1g-dev \
   >     libunistring-dev libaom-dev libdav1d-dev
   >   ```
   >
   > - Fedora/RHEL/CentOS
   >
   >   ```sh
   >   yum remove --purge -y \
   >      autoconf automake bzip2 bzip2-devel cmake freetype-devel \
   >      gcc gcc-c++ git libtool make pkgconfig zlib-devel
   >   ```

##### 1.7.1.1. 安装 [opencore-amr](https://sourceforge.net/projects/opencore-amr/ "opencore-amr download | SourceForge.net")

1. 进入用户源码目录并下载源码

   ```sh
   cd /usr/local/src && \
   sudo wget \
      https://sourceforge.net/projects/opencore-amr/files/opencore-amr/opencore-amr-0.1.6.tar.gz/download
   ```

2. 解压、编译源码并安装

   ```sh
   sudo tar -xf download -C .
   ```

   ```sh
   cd opencore-amr-0.1.6 && \
   sudo ./configure
   ```

   ```sh
   sudo make
   ```

   ```sh
   sudo make install
   ```

#### 1.7.2. 获取、编译并安装 FFmpeg

1. 进入用户源码目录并下载源码

   ```sh
   cd /usr/local/src && \
   sudo git clone --depth=1 https://git.ffmpeg.org/ffmpeg.git ffmpeg
   ```

   > **解释**
   >
   > `--depth` 参数用于指定克隆深度。当 `depth=1` 时，将会只克隆仓库的最近一次提交数据。此举可有效解决仓库过大无法克隆或仓库占用存储太高的问题。

2. 解压、编译源码并安装

   ```sh
   cd ffmpeg && \
   sudo ./configure --enable-gpl --enable-version3 --enable-nonfree --disable-ffplay \
      --enable-ffprobe --enable-libopencore-amrnb --enable-libopencore-amrwb
   ```

   > **解释**
   >
   > - `--enable-gpl --enable-version3` 即使用 GPL（General Pubilc License，GNU 通用公共许可协议）进行编译。开启后方可使
   > - `--enable-nonfree` 即允许只用非自由代码。
   > - `--disable-ffplay` 即关闭 FFplay 功能。因我们只需要语音编码功能，此处可关闭。
   > - `--enable-ffprobe` 即开启 FFprobe 功能。此功能用于查看多媒体文件信息。
   > - `--enable-libopencore-amrnb --enable-libopencore-amrwb` 即开启 AMR 编码功能。QQ 语音就是使用 AMR 编码，因此我们此处开启之。

   ```sh
   sudo make
   ```

   ```sh
   sudo make install
   ```

> **注意**
>
> 安装完 FFmpeg 后运行时出现 `ffmpeg: error while loading shared libraries: *.so.0: cannot open shared object file: No such file or directory` 这类的消息，可尝试运行以下命令解决：
>
> ```sh
> sudo sh -c "echo '/usr/local/lib' /etc/ld.so.conf" && \
> sudo ldconfig
> ```
>
> **提示**
>
> 详见[官方文档](https://trac.ffmpeg.org/wiki/CompilationGuide "CompilationGuide - FFmpeg")。

### 1.8. 安装 [PNPM](https://pnpm.io/ "Fast, disk space efficent package manager | pnpm")

1. 使用独立脚本进行安装

   - Debian/Ubuntu/Fedora/RHEL/CentOS/Arch

     ```sh
     curl -fsSL https://get.pnpm.io/install.sh | sh -
     ```

   - Alpine

     1. 下载 PNPM 并更改其权限

        ```sh
        sudo curl -fsSL \
           "https://github.com/pnpm/pnpm/releases/latest/download/pnpm-linuxstatic-x64" \
           -o /bin/pnpm && \
        sudo chmod +x /bin/pnpm
        ```

     2. 将当前用户的 Shell 更改为 Bash

        ```sh
        sudo usermod -s /bin/bash username && \
        chsh -s /bin/bash
        ```

     3. 安装 PNPM

        ```sh
        pnpm setup && \
        source ~/.bashrc
        ```

     4. 安装 Node

        ```sh
        sudo apk add nodejs
        ```

   > **解释**
   >
   > - `-f` 即 `--fail`，表示在服务器错误时，阻止一个返回的表示错误原因的 HTML 页面，而由 `curl` 命令返回一个错误码 22 来提示错误。
   > - `-s` 即 `--silent`，安静模式。不显示进度表或错误信息。使 `curl` 静音。它仍然会输出您请求的数据，甚至可能输出到终端 STDOut，除非您对它进行重定向。
   > - `-S` 参数指定只输出错误信息，通常与 `-s` 一起使用。
   > - `-L`,--location:如果服务器报告请求的页面已移动到其他位置（用 location:header 和 3xx 响应代码），此选项将使 `curl` 在新位置上重新执行请求。
   > - `--show-error`：当与 `-s` 即 `--silent` 一起使用时，它会使 `curl` 在失败时显示错误消息。
   > - `-o` 参数将服务器的回应保存成文件，等同于 `wget` 命令。
   > - `sh -` 即运行上一命令返回的命令行输出。

2. 使环境变量更改在此终端会话生效

   ```sh
   source ~/.bashrc
   ```

> **提示**
>
> - 在使用 PNPM 时，可能会出现 `ENOENT not found: node` 错误，可使用以下命令解决。
>
>   ```sh
>   pnpm env use --global latest
>   ```
>
> - 当运行 `pnpm add packge -w` 出现 `ERROR --workspace-root may only be used inside a workspace` 时，请移除 `-w` 参数。此情况一般在使用 V2 版云崽时利用 PNPM 安装依赖出现。
>
> - 详见[官方文档](https://pnpm.io/installation "Installation - pnpm")。

### 1.9. 下载云崽

#### 1.9.1. 下载云崽源码

- 下载[云崽 V3](https://github.com/Le-niao/Yunzai-Bot "Le-niao/Yunzai-Bot: 原神QQ群机器人")

  ```sh
  cd ~ && \
  git clone --depth=1 https://github.com/Le-niao/Yunzai-Bot.git
  ```

  > **注意**
  >
  > 若以上命令执行太慢或失败，可切换为 [Yunzai-Bot@Gitee](https://gitee.com/Le-niao/Yunzai-Bot.git "Gitee/Yunzai-Bot V3")。
  >
  > ```sh
  > git clone --depth=1 https://gitee.com/Le-niao/Yunzai-Bot.git
  > ```

- 下载[云崽 V2](https://github.com/yoimiya-kokomi/Yunzai-Bot "yoimiya-kokomi/Yunzai-Bot: 原神QQ群机器人")

  ```sh
  cd ~ && \
  git clone --depth=1 https://github.com/yoimiya-kokomi/Yunzai-Bot.git
  ```

  > **注意**
  >
  > - 若以上命令执行太慢或失败，可切换为 [Yunzai-Bot@Gitee](https://gitee.com/yoimiya-kokomi/Yunzai-Bot.git "Gitee/Yunzai-Bot V2")。
  >
  >   ```sh
  >   git clone --depth=1 https://gitee.com/yoimiya-kokomi/Yunzai-Bot.git
  >   ```
  >
  > - 当使用云崽 V2 时，利用 PNPM 管理依赖可能会出现 `Error [ERR_MODULE_NOT_FOUND]: Cannot find package` 错误，此时可以 `pnpm add packge`。
  >
  >   ```sh
  >   # 假设缺少 date-format
  >   pnpm add data-format
  >   ```

#### 1.9.2. 安装云崽依赖

1. 安装 [Puppeteer](https://developer.chrome.com/docs/puppeteer/ "Puppeteer - Chrome Developers") 依赖

   - Debian/Ubuntu

     ```sh
     sudo apt install -y libgbm-dev libasound2-dev libcups2 libxkbcommon0 \
        libxcomposite1 libnss3 libatk1.0-0  libxdamage1 libxfixes3 \
        libxrandr2 libpango-1.0-0 libcairo2 libatk-bridge2.0-0
     ```

   - Fedora/RHEL/CentOS

     ```sh
     yum install pango.x86_64 libXcomposite.x86_64 libXcursor.x86_64 libXdamage.x86_64 \
        libXext.x86_64 libXi.x86_64 libXtst.x86_64 cups-libs.x86_64 libXScrnSaver.x86_64 \
        libXrandr.x86_64 GConf2.x86_64 alsa-lib.x86_64 atk.x86_64 gtk3.x86_64 -y && \
     yum install libdrm libgbm libxshmfence -y && \
     yum install nss -y && \
     yum update nss -y
     ```

2. 安装 [Node](https://nodejs.org "Node.js") 依赖

   ```sh
   cd ~/Yunzai-Bot && \
   pnpm install
   ```

   > **注意**
   >
   > - 安装依赖时可能会报 `ENOENT not found: node` 错误，具体解决方法请前往[安装 PNPM](#18-安装-pnpm "安装 PNPM")下的提示查看。
   >
   > - 若安装依赖时出现 `node_modules/.pnpm/puppeteer@13.7.0/node_modules/puppeteer: Running install script... ELIFECYCLE Command failed.` 错误，可以添加 `--ignore-scripts` 参数安装 Puppeteer。
   >
   >   1. 安装 Puppeteer 时忽略安装脚本
   >
   >      ```sh
   >      cd ~/Yunzai-Bot && \
   >      pnpm install puppeteer -w --ignore-scripts
   >      ```
   >
   >   2. 手动使用安装脚本
   >
   >      ```sh
   >      node ./node_modules/puppeteer/install.js
   >      ```
   >
   > - 若运行云崽后提示 `chrome-linux/chrome: error while loading shared libraries: *.so.*`，可尝试运行以下步骤解决（请将 `{version}` 替换为 Linux 版本号，可在输入命令到 `linux` 后使用 `Tab` 键自动补全目录）：
   >
   >   1. 安装 `apt-file`
   >
   >      ```sh
   >      sudo apt install apt-file -y
   >      ```
   >
   >   2. 更新 `apt-file` 缓存
   >
   >      ```sh
   >      sudo apt-file update
   >      ```
   >
   >   3. 查找缺失依赖
   >
   >      ```sh
   >      cd ~/Yunzai-Bot/node_modules/puppeteer/.local-chromium/linux-{version}/chrome-linux && \
   >      ldd chrome | grep not
   >      ```
   >
   >   4. 之后会展示所有缺失的依赖组件，再使用 `apt-file search {*.so.*}`（请将 `{*.so.*}` 换成缺失的依赖组件）命令查询组件，而后使用 `sudo apt install {*} -y`（请将 `{*}` 换为查询到的组件）来安装组件。

> **提示**
>
> 详见[V3 官方文档](https://github.com/Le-niao/Yunzai-Bot#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95 "Le-niao/Yunzai-Bot: 原神QQ群机器人")、[V2 官方文档](https://github.com/yoimiya-kokomi/Yunzai-Bot#%E6%96%B0%E5%AE%89%E8%A3%85%E5%96%B5%E5%96%B5v2-yunzai "yoimiya-kokomi/Yunzai-Bot: 原神QQ群机器人")。

### 1.10. 下载云崽插件（可选）

> **提示**
>
> 插件可前往 [Yunzai-Bot-Plugins-index@Github](https://github.com/yhArcadia/Yunzai-Bot-plugins-index "yhArcadia/Yunzai-Bot-plugins-index: Yunzai-Bot云崽QQ机器人插件索引") 或 [Yunzai-Bot-plugins-index@Gitee](https://gitee.com/yhArcadia/Yunzai-Bot-plugins-index "Yunzai-Bot-plugins-index: Yunzai-Bot云崽QQ机器人插件索引") 查看。

#### 1.10.1. 下载[喵喵插件](https://github.com/yoimiya-kokomi/miao-plugin "yoimiya-kokomi/miao-plugin: Miao-Plugin for Yunzai-Bot")

##### 1.10.1.1. 下载喵喵插件源码

```sh
cd ~/Yunzai-Bot && \
git clone --depth=1 https://github.com/yoimiya-kokomi/miao-plugin.git ./plugins/miao-plugin
```

> **注意**
>
> 若以上命令执行太慢或失败，可切换为 [miao-plugin@Gitee](https://gitee.com/yoimiya-kokomi/miao-plugin.git "Gitee/miao-plugin")。
>
> ```sh
> git clone --depth=1 https://gitee.com/yoimiya-kokomi/miao-plugin.git ./plugins/miao-plugin
> ```

##### 1.10.1.2. 安装喵喵插件依赖

```sh
pnpm add image-size -w
```

> **提示**
>
> 详见[官方文档](https://github.com/yoimiya-kokomi/miao-plugin#%E5%AE%89%E8%A3%85%E4%B8%8E%E6%9B%B4%E6%96%B0 "yoimiya-kokomi/miao-plugin: Miao-Plugin for Yunzai-Bot")。

#### 1.10.2. 下载 [PY 插件](https://github.com/realhuhu/py-plugin "realhuhu/py-plugin: miao py-plugin")

##### 1.10.2.1. 安装 [Python](https://www.python.org "Welcome to Python.org")

> **注意**
>
> 若不想自行编译安装，可直接使用包管理器安装，括号里为当前最高版本，但不一定是当前系统支持的最高版本。请注意版本，若要安装 [TRSS-Plugin](https://github.com/TimeRainStarSky/TRSS-Plugin "TimeRainStarSky/TRSS-Plugin")，则 Python 版本应大于等于 3.10。
>
> - Debian（[3.9](https://packages.debian.org/bullseye/python3 "Debian -- 在 bullseye 中的 python3 软件包详细信息")）/Ubuntu（[3.10](https://packages.ubuntu.com/jammy/python3 "Ubuntu - 在 jammy 中的 python3 软件包详细信息")）
>
>   ```sh
>   sudo apt install python3 python-is-python3 -y
>   ```
>
> - Fedora（[3.11](https://packages.fedoraproject.org/pkgs/python3.11/python3/ "python3 - Fedora Packages")）/RHEL/CentOS（[3.9](https://centos.pkgs.org/9-stream/centos-baseos-x86_64/python3-3.9.14-1.el9.x86_64.rpm.html "python3-3.9.14-1.el9.x86_64.rpm CentOS 9 Stream Download")）
>
>   ```sh
>   sudo yum install python3 -y
>   ```
>
> - Arch（[3.10](https://archlinux.org/packages/core/x86_64/python/ "Arch Linux - python 3.10.8-2 (x86_64)")）
>
>   ```sh
>   sudo pacman -S python
>   ```
>
> - ~~Alpine（[3.10](https://pkgs.alpinelinux.org/package/edge/main/x86_64/python3 "Alpine Linux packages")）~~
>
>   ```sh
>   # sudo apk add python3
>   ```
>
> **注意**
>
> - Alpine 暂时不知如何正常使用 Poetry，因此请勿安装 PY 插件。若有大佬知道，请于下方指出。
>
> - 若是 Python 运行时报错 `python服务器已关闭 Error: 14 UNAVAILABLE: Connection dropped`，请在运行云崽时实时监测服务器的主存（运行内存）是否充足。
>
>   ```sh
>   free -h -s 3
>   ```

###### 1.10.2.1.1. 准备安装 Python

安装编译依赖

- Debian/Ubuntu

  ```sh
  sudo apt install -y libreadline-dev libncursesw5-dev libssl-dev libexpat1-dev \
     libsqlite3-dev tk-dev libgdbm-dev libc6-dev libbz2-dev libffi-dev zlib1g-dev
  ```

- Fedora/RHEL/CentOS

  ```sh
  sudo yum install -y zlib-devel bzip2-devel expat-devel gdbm-devel openssl-devel \
     ncurses-devel sqlite-devel readline-devel tk-devel libffi-devel
  ```

> **提示**
>
> 在所有步骤完成后，编译依赖可以卸载。
>
> - Debiian/Ubuntu
>
>   ```sh
>   sudo apt remove --purge -y libreadline-dev libncursesw5-dev libssl-dev libexpat1-dev \
>      libsqlite3-dev tk-dev libgdbm-dev libc6-dev libbz2-dev libffi-dev zlib1g-dev
>   ```
>
> - Fedora/RHEL/CentOS
>
>   ```sh
>   sudo yum remove --purge -y zlib-devel bzip2-devel expat-devel gdbm-devel openssl-devel \
>      ncurses-devel sqlite-devel readline-devel tk-devel libffi-devel
>   ```

###### 1.10.2.1.2. 获取、编译并安装 Python

1. 进入用户源码目录并下载源码

   ```sh
   cd /usr/local/src && \
   sudo wget https://www.python.org/ftp/python/3.10.8/Python-3.10.8.tar.xz
   ```

2. 解压、编译源码并安装

   ```sh
   sudo tar -xf Python-3.10.8.tar.xz
   ```

   ```sh
   cd Python-3.10.8 && \
   sudo ./configure --enable-optimizations
   ```

   ```sh
   sudo make
   ```

   ```sh
   sudo make install
   ```

> **注意**
>
> - 若使用 `python3` 命令时提示 `Command not found`，请通过创建软链接修复。
>
>   ```sh
>   sudo rm -rf /usr/local/bin/python3
>   sudo ln -s /usr/local/bin/python3.10 /usr/local/bin/python3
>   ```
>
> - 若想使 `python` 命令指向 `python3`，可通过创建软链接更改 `python` 的使用版本。`pip` 同理。更改后若跳出 `-bash: /usr/bin/python: No such file or directory` 错误，请重新启动终端。
>
>   ```sh
>   sudo rm -rf /usr/local/bin/python && \
>   sudo ln -s /usr/local/bin/python3 /usr/local/bin/python
>   ```
>
>   ```sh
>   sudo rm -rf /usr/local/bin/pip && \
>   sudo ln -s /usr/local/bin/pip3 /usr/local/bin/pip
>   ```
>
> - 若使用 `pip` 命令时提示 `Command not found`，可使用包管理器重新下载 PIP 修复。
>
>   - Debian/Ubuntu
>
>     ```sh
>     sudo apt-get install python3-pip -y
>     ```
>
> - 将 `python` 指向 `python3` 后，可能会导致 Cent OS 等系统使用 `yum` 命令出错，请使用 `vim /usr/bin/yum` 命令编辑 yum 文件并将文件开头 `#!/usr/bin/python` 改为 `#!/usr/bin/python2`。
>
> - 若出现 `Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]`，可将 `PYTHONHOME`、`PYTHONPATH` 加入环境变量。
>
>   ```sh
>   sudo cat >> ~/.bashrc << EOF
>
>   # Python
>   export PYTHONHOME=/usr/local/bin
>   export PYTHONPATH=/usr/local/lib/python3.10
>   # Python end
>   EOF
>   ```
>
>   ```sh
>   source ~/.bashrc
>   ```
>
> **提示**
>
> 详见[官方文档](https://docs.python.org/3/using/unix.html "2. Using Python on Unix platforms - Python 3.10.8 doumentation")

##### 1.10.2.2. 安装 [Poetry](https://python-poetry.org "Poetry - Python denpendency management and packaging made easy")

> **注意**
>
> ~~Alpine 请通过 `sudo apk add poetry` 安装。~~

1. 使用脚本安装 Poetry

   ```sh
   curl -sSL https://install.python-poetry.org | python3 -
   ```

2. 将 Poetry 添加至用户环境变量并刷新修改

   ```sh
   cat >> ~/.bashrc << EOF

   # poetry
   export POETRY_HOME="\$HOME/.local/bin"
   export PATH="\$POETRY_HOME:\$PATH"
   # poetry end
   EOF
   ```

   ```sh
   source ~/.bashrc
   ```

> **注意**
>
> - 若安装依赖时出现 `FileNotFoundError: [Errno 2] No such file or directory: '~/.local/share/pypoetry/venv/bin/python'` 错误,可尝试重新开启终端（关闭当前终端并开启新终端）解决。
>
> - 若运行时出现 `Error: spawn poetry ENOENT` 错误，可以通过手动创建 Poetry 软链接解决。
>
>   ```sh
>   sudo ln -s ~/.local/bin/poetry /usr/bin/poetry
>   ```
>
> **提示**
>
> - 安装完成后可使用 `poetry --version` 测试是否安装成功。
>
> - 详见[官方文档](https://python-poetry.org/docs/ "Introduction - Documentation - Poetry")。

##### 1.10.2.3. 下载 PY 插件源码

```sh
cd ~/Yunzai-Bot && \
git clone --depth=1 https://github.com/realhuhu/py-plugin.git ./plugins/py-plugin
```

> **注意**
>
> 若以上命令执行太慢或失败，可切换为 [py-plugin@Gitee](https://gitee.com/realhuhu/py-plugin.git "Gitee/py-plugin")。
>
> ```sh
> git clone --depth=1 https://gitee.com/realhuhu/py-plugin.git ./plugins/py-plugin
> ```

##### 1.10.2.4. 安装 PY 插件依赖

- 安装 Node 依赖

  ```sh
  pnpm add @grpc/grpc-js @grpc/proto-loader iconv-lite -w
  ```

- 安装 Python 依赖

  ```sh
  cd ~/Yunzai-Bot/plugins/py-plugin && \
  poetry install
  ```

> **注意**
>
> 在运行云崽时，若 PY 插件 `No module named 'sqlitedict'` 错误发生，可以手动安装 `sqlitedict` 解决。
>
> ```sh
> pip install -U sqlitedict
> ```
>
> **提示**
>
> 详见[官方文档](https://github.com/realhuhu/py-plugin#1%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87 "realhuhu/py-plugin: miao py-plugin")。

#### 1.10.3. 下载[图鉴插件](https://github.com/ctrlcvs/xiaoyao-cvs-plugin "ctrlcvs/xiaoyao-cvs-plugin: xiaoyao-cvs-Plugin for Yunzai-Bot")

##### 1.10.3.1. 下载图鉴插件源码

```sh
cd ~/Yunzai-Bot && \
git clone --depth=1 https://github.com/ctrlcvs/xiaoyao-cvs-plugin.git ./plugins/xiaoyao-cvs-plugin
```

> **注意**
>
> 若以上命令执行太慢或失败，可切换为 [xiaoyao-cvs-plugin@Gitee](https://gitee.com/Ctrlcvs/xiaoyao-cvs-plugin.git "Gitee/xiaoyao-cvs-plugin")。
>
> ```sh
> git clone --depth=1 https://gitee.com/Ctrlcvs/xiaoyao-cvs-plugin.git ./plugins/xiaoyao-cvs-plugin
> ```

##### 1.10.3.2. 安装图鉴插件依赖

```sh
pnpm add promise-retry superagent -w
```

> **提示**
>
> 详见[官方文档](https://github.com/ctrlcvs/xiaoyao-cvs-plugin#%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B "ctrlcvs/xiaoyao-cvs-plugin: xiaoyao-cvs-Plugin for Yunzai-Bot")。

#### 1.10.4. 下载[闲心插件](https://github.com/xianxincoder/xianxin-plugin "xianxincoder/xianxin-plugin: Yunzai-Bot云崽QQ机器人 v3插件")

> **注意**
>
> 此插件不适用于 V2 版本云崽。

```sh
cd ~/Yunzai-Bot && \
git clone --depth=1 https://github.com/xianxincoder/xianxin-plugin.git ./plugins/xianxin-plugin
```

> **注意**
>
> 若以上命令执行太慢或失败，可切换为 [xianxin-plugin@Gitee](https://gitee.com/xianxincoder/xianxin-plugin.git "Gitee/xianxin-plugin")。
>
> ```sh
> git clone --depth=1 https://gitee.com/xianxincoder/xianxin-plugin.git ./plugins/xianxin-plugin
> ```
>
> **提示**
>
> 详见[官方文档](https://github.com/xianxincoder/xianxin-plugin#-%E5%AE%89%E8%A3%85%E4%B8%8E%E6%9B%B4%E6%96%B0 "xianxincoder/xianxin-plugin: Yunzai-Bot云崽QQ机器人 v3插件")。

#### 1.10.5. 下载[锅巴插件](https://github.com/guoba-yunzai/guoba-plugin "guoba-yunzai/guoba-plugin: Yunzai-Bot的插件，主要提供后台管理界面。")

##### 1.10.5.1. 下载锅巴插件源码

```sh
cd ~/Yunzai-Bot && \
git clone --depth=1 https://gitee.com/guoba-yunzai/guoba-plugin.git ./plugins/guoba-plugin
```

> **注意**
>
> 若以上命令执行太慢或失败，可切换为 [guoba-plugin@Gitee](https://gitee.com/guoba-yunzai/guoba-plugin.git "Gitee/guoba-plugin")。
>
> ```sh
> git clone --depth=1 https://gitee.com/guoba-yunzai/guoba-plugin.git ./plugins/guoba-plugin
> ```

##### 1.10.5.2. 安装锅巴插件依赖

```sh
pnpm install --filter=guoba-plugin
```

> **提示**
>
> 详见[官方文档](https://github.com/guoba-yunzai/guoba-plugin#%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6 "guoba-yunzai/guoba-plugin: Yunzai-Bot的插件，主要提供后台管理界面。")。

#### 1.10.6. 下载[成就插件](https://github.com/zolay-poi/achievements-plugin "zolay-poi/achievements-plugin: achievements-plugin是Yunzai-Bot的扩展插件，提供成就查漏功能。 具体功能可在安装插件后，通过发送#成就帮助来进行查看。")

```sh
cd ~/Yunzai-Bot && \
git clone --depth=1 https://github.com/zolay-poi/achievements-plugin.git ./plugins/achievements-plugin
```

> **提示**
>
> - 若以上命令执行太慢或失败，可切换为 [achievements-plugin@Gitee](https://gitee.com/zolay-poi/achievements-plugin "Gitee/achievements-plugin")。
>
> ```sh
> git clone --depth https://gitee.com/zolay-poi/achievements-plugin.git ./plugins/achievements-plugin
> ```
>
> - 详见[官方文档](https://github.com/zolay-poi/achievements-plugin#%E5%AE%89%E8%A3%85%E4%B8%8E%E6%9B%B4%E6%96%B0 "zolay-poi/achievements-plugin: achievements-plugin是Yunzai-Bot的扩展插件，提供成就查漏功能。 具体功能可在安装插件后，通过发送#成就帮助来进行查看。")。

#### 1.10.7. 下载 [TRSS 插件](https://github.com/TimeRainStarSky/TRSS-Plugin "TimeRainStarSky/TRSS-Plugin")

> **注意**
>
> TRSS 插件对计算机要求较高，会占用较多的系统资源（如存储空间），请酌情使用。

##### 1.10.7.1. 准备 TRSS 插件环境

1. [安装 Python](#11021-安装-python "1.10.21. 安装 Python")

2. [安装 Poetry](#11022-安装-poetry "1.10.22. 安装 Poetry")

##### 1.10.7.2. 下载 TRSS 插件源码

```sh
cd ~/Yunzai-Bot && \
git clone --depth=1 https://github.com/TimeRainStarSky/TRSS-Plugin.git plugins/TRSS-Plugin
```

> **提示**
>
> 若以上命令执行太慢或失败，可切换为 [TRSS-Plugin@Gitee](https://gitee.com/TimeRainStarSky/TRSS-Plugin "Gitee/TRSS-Plugin")。
>
> ```sh
> git clone --depth=1 https://gitee.com/TimeRainStarSky/TRSS-Plugin.git plugins/TRSS-Plugin
> ```

##### 1.10.7.3. 安装 TRSS 插件依赖

```sh
pnpm install
```

##### 1.10.7.4. 安装原神语音合成功能

1. 下载原神语音合成仓库

   ```sh
   cd ~/Yunzai-Bot/plugins/TRSS-Plugin && \
   git clone --depth=1 https://github.com/TimeRainStarSky/genshin-voice.git
   ```

   > **提示**
   >
   > 若以上命令执行太慢或失败，可切换为 [genshin-voice@Gitee](https://github.com/TimeRainStarSky/genshin-voice "Gitee/genshin-voice")。
   >
   > ```sh
   > git clone --depth=1 https://gitee.com/TimeRainStarSky/genshin-voice.git
   > ```

2. 安装 Python 依赖

   ```sh
   cd genshin-voice && \
   poetry install
   ```

   ```sh
   poetry run pip install monotonic-align
   ```

3. 下载原神语音模型

   ```sh
   curl -LO https://github.com/TimeRainStarSky/TRSS-Plugin/releases/download/latest/G_809000.pth.xz
   ```

4. 解压原神语音模型

   ```sh
   xz -dv G_809000.pth.xz
   ```

> **提示**
>
> 详见[官方文档](https://github.com/TimeRainStarSky/TRSS-Plugin#%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B "TimeRainStarSky/TRSS-Plugin")。

## 2. 运行云崽

### 2.1. 运行 Redis

```sh
mkdir ~/Yunzai-Bot/data && \
cd ~/Yunzai-Bot/data && \
redis-server --save 900 1 --save 300 10 --daemonize yes
```

> **解释**
>
> 这将会使 Redis 生成的 `dump.rdb` 文件存放至 `Yunzai-Bot/data` 文件夹中。
>
> **注意**
>
> 若 `dump.rdb` 不在此文件夹下，则可能在 `/var/lib/redis/` 目录下。可以通过 `whereis redis` 命令查找 Redis 安装位置，再通过命令 `cat /path/to/redis/redis.conf | grep "dir "` 查看数据库文件存储位置。
>
> **提示**
>
> 若想要恢复 Redis 数据，请将 `dump.rdb` 文件放置在 Redis 数据库文件存储位置，再运行 Redis。注意 `dump.rdb` 文件的权限。
>
> ```sh
> sudo chown redis:redis /var/lib/redis/dump.rdb && \
> sudo chmod 644 /var/lib/redis/dump.rdb
> ```

### 2.2. 首次运行云崽

```sh
cd ~/Yunzai-Bot && \
node app
```

> **注意**
>
> - 运行后请更改云崽的配置。
>
>   - V3 配置位置：`~/Yunzai-Bot/config/config/`
>
>   - V2 配置位置：`~/Yunzai-Bot/config/config.js`
>
> - 使用 V3 云崽时若[安装了 FFmpeg](#17-安装-ffmpeg可选)，请在云崽配置中加入 FFmpeg 位置。
>
>   1. 查看 FFmpeg 安装位置
>
>      ```sh
>      whereis ffmpeg && \
>      whereis ffprobe
>      ```
>
>   2. 修改配置
>
>      ```sh
>      vim ~/Yunzai-Bot/config/config/bot.yaml
>      ```
>
>      修改为
>
>      ```yml
>      # 日志等级:trace,debug,info,warn,fatal,mark,error,off
>      # mark时只显示执行命令，不显示聊天记录
>      log_level: info
>      # 群聊和频道中过滤自己的消息
>      ignore_self: true
>      # 被风控时是否尝试用分片发送
>      resend: false
>      # ffmpeg
>      # 假设位置为 /usr/local/bin/ffmpeg 及 /usr/local/bin/ffprobe。
>      ffmpeg_path: /usr/local/bin/ffmpeg
>      ffprobe_path: /usr/local/bin/ffprobe
>
>      # chromium其他路径
>      chromium_path:
>      ```
>
> **提示**
>
> QQ 登录提示存在安全风险解决方法有以下几种。
>
> 在[此处](https://github.com/Le-niao/Yunzai-Bot/issues/106 "Github/Yunzai-Bot/Issue-106")讨论。
>
> - 在本地登录后将登录数据传至服务端
>
>   1. 先在本地登录
>
>      可以尝试先在 WSL 上登录账号。该方法也可以使用其他的 Linux 虚拟机。如果有能力的话，也可以直接在本地 Windows 或是安卓上进行登录操作。成功以后将云崽数据传至服务端。
>
>      1. 进入 `Yunzai-Bot` 文件夹。
>
>         ```sh
>         cd /path/to/Yunzai-Bot
>         ```
>
>      2. 使用 `tar` 命令打包上的 `Yunzai-Bot/data` 文件夹。
>
>         ```sh
>         tar -cf data.tar data
>         ```
>
>      3. 将 `data.tar` 从本地上传至服务器。
>
>         ```sh
>         scp data.tar user@server.ip:/path/to/Yunzai-Bot/
>         ```
>
>   2. 再在服务器上操作
>
>      1. 进入 `Yunzai-Bot` 文件夹。
>
>         ```sh
>         cd /path/to/Yunzai-Bot
>         ```
>
>      2. 删除服务器上的 `Yunzai-Bot/data` 文件夹。
>
>         ```sh
>         rm -rf data
>         ```
>
>      3. 解压 `data.tar` 至 `Yunzai-Bot` 文件夹。
>
>         ```sh
>         tar -xf data.tar -C data
>         ```
>
>      4. 使用 `node app` 启动项目。
>
>         ```sh
>         node app
>         ```
>
> - 使用代理进行登录
>
>   你可以在服务器端搭建代理服务（_PPTP_、_v2ray_ 什么的），之后手机上以全局模式连接此代理，再进行扫码登录的操作。具体操作比较麻烦，可以百度以下。
>
> - 在服务端使用 Windows
>
>   该灵感来自[这里](https://github.com/Le-niao/Yunzai-Bot/issues/106#issuecomment-1120669801 "Github/Yunzai-Bot/Issue-106")。
>
>   先使用 Windows 系统登录 QQ 挂几天，再将服务器改为 Linux 系统使用云崽。

### 2.3. 后台启动

```sh
cd ~/Yunzai-Bot && \
pnpm start
```

### 2.4. 后台重启

```sh
cd ~/Yunzai-Bot && \
pnpm restart
```

### 2.5. 后台查看运行日志

```sh
cd ~/Yunzai-Bot && \
pnpm run log
```

## 3. 友好链接

- 教程更新地址：[锐毅的博客](https://blog.shuery.lssa.fun/应用/云崽/2022/10/18/云崽安装教程.html "云崽安装教程 - 锐毅的博客")

  因 Github Issue 不方便频繁更新，就建了个博客放这个了。

- 讨论地址：[Issues #154](https://github.com/Le-niao/Yunzai-Bot/issues/154 "云崽安装教程·Issues #154·Le-niao/Yunzai-Bot")

  博客并没有搭建好，就先在 Issues 里讨论好了。
